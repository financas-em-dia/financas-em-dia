<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Finan√ßas em Dia</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
--bg:#0f172a;--card:#020617;--primary:#22c55e;--danger:#ef4444;
--text:#e5e7eb;--muted:#94a3b8;--input:#020617;--border:#1e293b;
}
*{box-sizing:border-box;font-family:system-ui;}
body{margin:0;background:linear-gradient(180deg,#020617,#0f172a);color:var(--text);padding:12px;}
.container{max-width:480px;margin:auto;}
h1{text-align:center;margin:10px 0;font-size:1.4rem;}
.hidden{display:none;}
button{cursor:pointer}

input,select{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:var(--input);color:var(--text);}
label{font-size:.75rem;color:var(--muted);}
.field{margin-bottom:10px;}

.box{background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:14px;padding:16px;margin-top:20px;}

button.main{width:100%;padding:12px;border:none;border-radius:12px;background:linear-gradient(135deg,#22c55e,#16a34a);color:#052e16;font-weight:700;margin-top:6px;}
button.sec{width:100%;padding:10px;border:1px solid var(--border);border-radius:12px;background:transparent;color:var(--text);margin-top:6px;}
.plus{width:36px;margin-left:6px;border-radius:8px;background:#22c55e;border:none;color:#052e16;font-weight:800}

.top-tabs{display:flex;gap:8px;margin-bottom:10px;}
.top-tabs button{flex:1;padding:10px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,0.05);color:var(--text);font-weight:600;}
.top-tabs button.active{background:linear-gradient(135deg,#22c55e,#16a34a);color:#052e16;}

.cards{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.card{background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:14px;padding:12px;}
.card h3{font-size:.75rem;color:var(--muted);margin:0 0 6px;}
.card .value{font-size:1.1rem;font-weight:600;}
.card.saldo{grid-column:1/3;text-align:center;}

.item{display:grid;grid-template-columns:1fr auto auto;gap:6px;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);font-size:.78rem;}
.valor.rec{color:var(--primary)} .valor.desp{color:var(--danger)}
.actions button{border:none;border-radius:6px;padding:4px 6px;font-size:.7rem}
.pay{background:#22c55e;color:#052e16} .del{background:#ef4444;color:#fff}
</style>
</head>

<body>
<div class="container">

<!-- LOGIN -->
<div id="loginScreen">
<h1>üîê Finan√ßas em Dia</h1>
<div class="box">
<div class="field"><label>Email</label><input id="emailLogin"></div>
<div class="field"><label>Senha</label><input id="senhaLogin" type="password"></div>
<button class="main" id="btnLogin">Entrar</button>
<button class="sec" id="btnReset">Esqueci minha senha</button>
<hr style="margin:14px 0;border-color:#1e293b">
<button class="main" id="btnGoogle">Entrar com Google</button>
</div>
</div>

<!-- APP -->
<div id="appScreen" class="hidden">

<h1>üí∞ Finan√ßas em Dia</h1>

<div class="top-tabs">
<button id="tabMes" class="active">M√™s</button>
<button id="tabAno">Resumo Anual</button>
</div>

<div id="telaMes">

<select id="mesSelecionado"></select>

<div class="cards">
<div class="card"><h3>Receitas</h3><div id="rMes" class="value">R$0</div></div>
<div class="card"><h3>Despesas</h3><div id="dMes" class="value">R$0</div></div>
<div class="card saldo"><h3>Saldo</h3><div id="sMes" class="value">R$0</div></div>
</div>

<div class="box">
<h3>Novo Lan√ßamento</h3>

<div class="field"><label>Tipo</label>
<select id="tipo"><option value="">Selecione</option><option value="receita">Receita</option><option value="despesa">Despesa</option></select></div>

<div class="field"><label>Categoria</label>
<div style="display:flex">
<select id="categoria"></select>
<button class="plus" id="btnCat">+</button>
</div></div>

<div class="field"><label>Valor</label><input id="valor" type="number"></div>
<div class="field"><label>Data</label><input id="data" type="date"></div>

<button class="main" id="btnAdd">Adicionar</button>
</div>

<div id="listaMes"></div>
<canvas id="grafMes"></canvas>

</div>

<div id="telaAno" class="hidden">
<div class="cards">
<div class="card"><h3>Receitas Ano</h3><div id="rAno" class="value">R$0</div></div>
<div class="card"><h3>Despesas Ano</h3><div id="dAno" class="value">R$0</div></div>
<div class="card saldo"><h3>Saldo Ano</h3><div id="sAno" class="value">R$0</div></div>
</div>
<canvas id="grafAno"></canvas>
</div>

<button class="sec" id="btnLogout">Sair</button>

</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithRedirect, getRedirectResult,
signInWithEmailAndPassword, sendPasswordResetEmail, onAuthStateChanged, signOut } 
from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, query, onSnapshot }
from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyBAWyMjRVAODIVkC5w95nu9MliqNUMb8ZY",
authDomain: "controle-financeiro-dffee.firebaseapp.com",
projectId: "controle-financeiro-dffee",
storageBucket: "controle-financeiro-dffee.firebasestorage.app",
messagingSenderId: "470526358884",
appId: "1:470526358884:web:0dcd3dffb5c0924dadf671"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

btnLogin.onclick=()=>signInWithEmailAndPassword(auth,emailLogin.value,senhaLogin.value).catch(e=>alert(e.message));
btnGoogle.onclick=()=>signInWithRedirect(auth,provider);
btnReset.onclick=()=>sendPasswordResetEmail(auth,emailLogin.value).then(()=>alert("Email enviado"));

btnLogout.onclick=()=>signOut(auth);

let uid="", dados=[], categorias=[];

onAuthStateChanged(auth, async user=>{
if(!user){ appScreen.classList.add("hidden"); loginScreen.classList.remove("hidden"); return;}
uid=user.uid;
loginScreen.classList.add("hidden");
appScreen.classList.remove("hidden");
carregarDados();
});

async function carregarDados(){
onSnapshot(query(collection(db,"users",uid,"lancamentos")),snap=>{
dados=snap.docs.map(d=>({...d.data(),id:d.id}));
atualizarMes(); atualizarAno();
});
onSnapshot(query(collection(db,"users",uid,"categorias")),snap=>{
categorias=snap.docs.map(d=>d.data().nome);
if(!categorias.length) categorias=["Sal√°rio","Alimenta√ß√£o","Aluguel","Lazer"];
categoria.innerHTML= categorias.map(c=>`<option>${c}</option>`).join("");
});
}

btnCat.onclick=async()=>{
let n=prompt("Nova categoria:");
if(n) await addDoc(collection(db,"users",uid,"categorias"),{nome:n});
}

btnAdd.onclick=async()=>{
if(!tipo.value||!categoria.value||!valor.value||!data.value) return alert("Preencha tudo");
await addDoc(collection(db,"users",uid,"lancamentos"),{
tipo:tipo.value, cat:categoria.value, valor:+valor.value,
mes:new Date(data.value).getMonth(), status:"pago"
});
}

function atualizarMes(){
let m=mesSelecionado.value||new Date().getMonth();
let r=0,d=0;
listaMes.innerHTML="";
dados.filter(i=>i.mes==m).forEach(i=>{
i.tipo=="receita"?r+=i.valor:d+=i.valor;
listaMes.innerHTML+=`<div class="item">
<div>${i.cat}</div>
<div class="valor ${i.tipo=="receita"?"rec":"desp"}">R$${i.valor}</div>
</div>`;
});
rMes.innerText=`R$ ${r}`; dMes.innerText=`R$ ${d}`; sMes.innerText=`R$ ${r-d}`;
}

function atualizarAno(){
let r=0,d=0;
dados.forEach(i=>i.tipo=="receita"?r+=i.valor:d+=i.valor);
rAno.innerText=`R$ ${r}`; dAno.innerText=`R$ ${d}`; sAno.innerText=`R$ ${r-d}`;
}

const meses=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];
meses.forEach((m,i)=>mesSelecionado.innerHTML+=`<option value="${i}">${m}</option>`);
mesSelecionado.onchange=atualizarMes;

tabMes.onclick=()=>{telaMes.classList.remove("hidden");telaAno.classList.add("hidden");tabMes.classList.add("active");tabAno.classList.remove("active");}
tabAno.onclick=()=>{telaAno.classList.remove("hidden");telaMes.classList.add("hidden");tabAno.classList.add("active");tabMes.classList.remove("active");}

</script>
</body>
</html>


